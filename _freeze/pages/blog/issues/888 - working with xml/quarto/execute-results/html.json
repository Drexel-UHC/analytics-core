{
  "hash": "ab6637655a0c783f4f725e42f3a9ded7",
  "result": {
    "markdown": "---\nauthor: Ran Li\ndate: \"08/31/2023\"\ntitle: \"Working with .XML in R\"\ndescription: \"This post discusses how to use R programming language to read, parse, and manipulate XML files, covering two R packages and techniques for accessing elements and converting XML files to R data structures like tibbles and data.frames. In this post we will with two packages xml2 and XML.\"\ncategories:\n  - tidy data\n  - XML\nformat: \n  html:\n    toc: true\n    toc-location: left\n    df-print: paged\n    code-tools: true\nexecute: \n  warning: false\neditor_options: \n  chunk_output_type: console\n---\n\n\n<img src=\"images/xml-logo.jpg\" alt=\"XML Logo\" style=\"height: 150px; display: block; margin: auto;\"/>\n\n\n## Basic: Read and Parse XML Files\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(xml2)\nlibrary(XML)\nlibrary(dplyr)\n\n## Load \nemployee_data <- read_xml(\"data.xml\")\nemployee_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{xml_document}\n<records>\n[1] <employee>\\n  <id>1</id>\\n  <first_name>John</first_name>\\n  <last_name>S ...\n[2] <employee>\\n  <id>2</id>\\n  <first_name>Jane</first_name>\\n  <last_name>S ...\n[3] <employee>\\n  <id>3</id>\\n  <first_name>Frank</first_name>\\n  <last_name> ...\n[4] <employee>\\n  <id>4</id>\\n  <first_name>Judith</first_name>\\n  <last_name ...\n[5] <employee>\\n  <id>5</id>\\n  <first_name>Karen</first_name>\\n  <last_name> ...\n```\n:::\n:::\n\n\nLet's first get a sense of the loaded data whats in it and what we want to parse. We can just see structure with `xml_structure()`.\n\n \n\n::: {.cell}\n\n```{.r .cell-code}\n## Get a sense of structure\nxml_structure(employee_data)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<records>\n  <employee>\n    <id>\n      {text}\n    <first_name>\n      {text}\n    <last_name>\n      {text}\n    <position>\n      {text}\n    <salary>\n      {text}\n    <hire_date>\n      {text}\n    <department>\n      {text}\n  <employee>\n    <id>\n      {text}\n    <first_name>\n      {text}\n    <last_name>\n      {text}\n    <position>\n      {text}\n    <salary>\n      {text}\n    <hire_date>\n      {text}\n    <department>\n      {text}\n  <employee>\n    <id>\n      {text}\n    <first_name>\n      {text}\n    <last_name>\n      {text}\n    <position>\n      {text}\n    <salary>\n      {text}\n    <hire_date>\n      {text}\n    <department>\n      {text}\n  <employee>\n    <id>\n      {text}\n    <first_name>\n      {text}\n    <last_name>\n      {text}\n    <position>\n      {text}\n    <salary>\n      {text}\n    <hire_date>\n      {text}\n    <department>\n      {text}\n  <employee>\n    <id>\n      {text}\n    <first_name>\n      {text}\n    <last_name>\n      {text}\n    <position>\n      {text}\n    <salary>\n      {text}\n    <hire_date>\n      {text}\n    <department>\n      {text}\n```\n:::\n:::\n\n\n\nWe can see that within this XML data there are many employees each with several features such as `first_name` or `position`. If we want to just explore values within a specific feature we can use `xml_find_all`. For exemple all values for the `position` tag.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxml_find_all(employee_data, \".//position\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{xml_nodeset (5)}\n[1] <position>CEO</position>\n[2] <position>Marketing Associate</position>\n[3] <position>R Developer</position>\n[4] <position>Data Scientist</position>\n[5] <position>Accountant</position>\n```\n:::\n:::\n\n\ntaking it one step farther we can start pulling these values into R data objects. For example to get a vector of string of all `positions`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxml_find_all(employee_data, \".//position\") %>% xml_text()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"CEO\"                 \"Marketing Associate\" \"R Developer\"        \n[4] \"Data Scientist\"      \"Accountant\"         \n```\n:::\n:::\n\n\nWhile you can work with vectors. Its best to import XML and convert to dataframes to be able to utilize dplyr for data manipulation and access.\n\n## Convert XML Data to tibble\n\nHere we will build ontop of the logic above. And extract three features of the XML data into a tibble. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract department and salary info\nid <- xml_text(xml_find_all(employee_data, \".//id\"))\ndept <- xml_text(xml_find_all(employee_data, \".//department\"))\nsalary <- xml_integer(xml_find_all(employee_data, \".//salary\"))\n\n# Format as a tibble\ndf_dept_salary <- tibble(id = id, department = dept, salary = salary)\ndf_dept_salary\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"department\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"salary\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Management\",\"3\":\"10000\"},{\"1\":\"2\",\"2\":\"Marketing\",\"3\":\"3500\"},{\"1\":\"3\",\"2\":\"IT\",\"3\":\"6000\"},{\"1\":\"4\",\"2\":\"IT\",\"3\":\"6500\"},{\"1\":\"5\",\"2\":\"Accounting\",\"3\":\"4000\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNow we have a dataframe we can start analyzing, for example to calculate the average salary by deparement.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_dept_salary %>% \n  group_by(department) %>% \n  summarise(salary = mean(salary))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"department\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"salary\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Accounting\",\"2\":\"4000\"},{\"1\":\"IT\",\"2\":\"6250\"},{\"1\":\"Management\",\"2\":\"10000\"},{\"1\":\"Marketing\",\"2\":\"3500\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nAnother approach to converting the entire XML document into an R data.frame, we can utilize the `xmlToDataFrame()` method from the `XML` package. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## parse\nemployee_xml <- xmlParse(employee_data)\nemployee_xml\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<records>\n  <employee>\n    <id>1</id>\n    <first_name>John</first_name>\n    <last_name>Smith</last_name>\n    <position>CEO</position>\n    <salary>10000</salary>\n    <hire_date>2022-1-1</hire_date>\n    <department>Management</department>\n  </employee>\n  <employee>\n    <id>2</id>\n    <first_name>Jane</first_name>\n    <last_name>Sense</last_name>\n    <position>Marketing Associate</position>\n    <salary>3500</salary>\n    <hire_date>2022-1-15</hire_date>\n    <department>Marketing</department>\n  </employee>\n  <employee>\n    <id>3</id>\n    <first_name>Frank</first_name>\n    <last_name>Brown</last_name>\n    <position>R Developer</position>\n    <salary>6000</salary>\n    <hire_date>2022-1-15</hire_date>\n    <department>IT</department>\n  </employee>\n  <employee>\n    <id>4</id>\n    <first_name>Judith</first_name>\n    <last_name>Rollers</last_name>\n    <position>Data Scientist</position>\n    <salary>6500</salary>\n    <hire_date>2022-3-1</hire_date>\n    <department>IT</department>\n  </employee>\n  <employee>\n    <id>5</id>\n    <first_name>Karen</first_name>\n    <last_name>Switch</last_name>\n    <position>Accountant</position>\n    <salary>4000</salary>\n    <hire_date>2022-1-10</hire_date>\n    <department>Accounting</department>\n  </employee>\n</records>\n \n```\n:::\n\n```{.r .cell-code}\n## convert to df\ndf_employees <- xmlToDataFrame(nodes = getNodeSet(employee_xml, \"//employee\")) %>%\n  as_tibble()\ndf_employees\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"first_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"position\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"salary\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"hire_date\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"department\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"John\",\"3\":\"Smith\",\"4\":\"CEO\",\"5\":\"10000\",\"6\":\"2022-1-1\",\"7\":\"Management\"},{\"1\":\"2\",\"2\":\"Jane\",\"3\":\"Sense\",\"4\":\"Marketing Associate\",\"5\":\"3500\",\"6\":\"2022-1-15\",\"7\":\"Marketing\"},{\"1\":\"3\",\"2\":\"Frank\",\"3\":\"Brown\",\"4\":\"R Developer\",\"5\":\"6000\",\"6\":\"2022-1-15\",\"7\":\"IT\"},{\"1\":\"4\",\"2\":\"Judith\",\"3\":\"Rollers\",\"4\":\"Data Scientist\",\"5\":\"6500\",\"6\":\"2022-3-1\",\"7\":\"IT\"},{\"1\":\"5\",\"2\":\"Karen\",\"3\":\"Switch\",\"4\":\"Accountant\",\"5\":\"4000\",\"6\":\"2022-1-10\",\"7\":\"Accounting\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## Summary\n\nIn conclusion, XML files are increasingly popular as a FAIR (especially interoperable) data format for the exhchange of data/metadata between systems. As a data professional, mastering the manipulation and analysis of XML files is not just an optional skill but a necessity. XML files are pervasive in various sectors, serving as a standard for data exchange. The article highlights that most tasks you'll encounter in R related to XML boil down to three core activities: loading the XML document, parsing its content, and converting it into a more analysis-friendly format like a tibble or data.frame.\n\nThe article introduces two R packages that facilitate these tasks, although it doesn't specify their names. These packages are likely equipped with a range of functionalities—from basic XML reading and writing to more advanced operations like XPath querying and namespace management. By leveraging these packages, data professionals can significantly simplify and optimize their workflow when dealing with XML files, making the process more efficient and accurate.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}